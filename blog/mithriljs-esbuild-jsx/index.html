<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <meta name="description" content="kevin f.'s personal site" />
        <link rel="shortcut icon" href="&#x2F;img&#x2F;favicon.png" type="image/x-icon" />
        <link rel="stylesheet" href="&#x2F;css&#x2F;main.css" />
        
        

        
          <link rel="alternate" type="application/atom+xml" title="RSS" href='&#x2F;atom.xml'>
        
        <title>
            
                Mithril.js + esbuild + JSX
            
        </title>
    </head>

    <body>
        <div class="dark-mode-container">
            <input id="darkSwitch" type="checkbox" />
            <label class="dark-mode-btn" for="darkSwitch">ðŸŒ’</label>
        </div>
        <main class="main-content max-width-3 mx-auto">
            <div>
                
    <div class="controls p1">
        <a href="https://github.com/kevinfiol/kevinfiol.com/edit/master/content/blog/mithriljs-esbuild-jsx.md">edit</a>
    </div>

    <header>
        <nav>
            <p class="h3">
                <a href="/">kevin f.</a>
            </p>
        </nav>
    </header>

    <small class="h5 p0 m0 light-subdue">
        March 18, 2021
    </small>

    <aside>
        
            
        
    </aside>

    <article class="page-content">
        <h1 id="mithril-js-esbuild-jsx"><a class="zola-anchor" href="#mithril-js-esbuild-jsx" aria-label="Anchor link for: mithril-js-esbuild-jsx">#</a>Mithril.js + esbuild + JSX</h1>
<p>I recently bootstrapped a <a href="https://mithril.js.org">Mithril.js</a> project using <a href="https://esbuild.github.io/">esbuild</a> for my bundling purposes. If you don't already know, esbuild is a next-gen bundler written in Go by <a href="https://github.com/evanw">Evan Wallace</a> that is magnitudes faster than rollup, webpack, or parcel (all of which are written in JS/TS).</p>
<p>esbuild comes with JSX support out of the box. While I don't normally use JSX, I decided to create a demo for <a href="https://mithril.netlify.app">mithril.netlify.app</a> showing off that JSX works just fine in a Mithril application. However, I ran into one major issue -- esbuild wasn't compiling JSX fragments correctly when providing <code>m.fragment</code> as the JSX fragment pragma. </p>
<p>After some digging around, I found <a href="https://gitter.im/mithriljs/mithril.js?at=5b98ce1c51a02e2a261ac656">this comment</a> by <a href="https://github.com/isiahmeadows">Claudia Meadows</a>.</p>
<p>In short, there's no support for Mithril fragments as Components currently. esbuild (as well as transpilers like Sucrase) compiles JSX using the provided jsx pragma + jsx fragment method in the form of:</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#bf616a;">React</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">createElement</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">React</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">Fragment</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">null</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">Stuff</span><span style="color:#c0c5ce;">&quot;);
</span></code></pre>
<p>See <a href="https://esbuild.github.io/api/#jsx-fragment">here</a> for more details.</p>
<p>Which in Mithril's case, can't work with <code>m.fragment</code>. Following Claudia's advice, defining a simple Fragment component as so worked for me. I just put this in my <code>index.js</code> file near the top:</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#bf616a;">m</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">Fragment </span><span style="color:#c0c5ce;">= { </span><span style="color:#8fa1b3;">view</span><span style="color:#c0c5ce;">: </span><span style="color:#bf616a;">vnode </span><span style="color:#b48ead;">=&gt; </span><span style="color:#bf616a;">vnode</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">children </span><span style="color:#c0c5ce;">};
</span></code></pre>
<p>Then I just set <code>jsxFragment</code> to <code>m.Fragment</code> instead of <code>m.fragment</code> in my esbuild config and voilÃ ! Fragments work as you'd expect.</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#b48ead;">var </span><span style="color:#bf616a;">JSX </span><span style="color:#c0c5ce;">= {
    </span><span style="color:#8fa1b3;">view</span><span style="color:#c0c5ce;">: </span><span style="color:#b48ead;">function</span><span style="color:#c0c5ce;">() {
        </span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">(
            &lt;&gt;
                &lt;h2&gt;</span><span style="color:#bf616a;">JSX</span><span style="color:#c0c5ce;">&lt;/</span><span style="color:#bf616a;">h2</span><span style="color:#c0c5ce;">&gt;
                &lt;p&gt;</span><span style="color:#bf616a;">You could use JSX with Mithril</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">js </span><span style="color:#b48ead;">as </span><span style="color:#c0c5ce;">well.&lt;/p&gt;
                &lt;p&gt;</span><span style="color:#bf616a;">Be aware that this requires a build</span><span style="color:#c0c5ce;">-</span><span style="color:#bf616a;">step</span><span style="color:#c0c5ce;">.&lt;/</span><span style="color:#bf616a;">p</span><span style="color:#c0c5ce;">&gt;
                &lt;p style={{ </span><span style="color:#bf616a;">color</span><span style="color:#c0c5ce;">: &#39;</span><span style="color:#a3be8c;">red</span><span style="color:#c0c5ce;">&#39; }}&gt;
                    </span><span style="color:#bf616a;">Attributes work </span><span style="color:#b48ead;">as </span><span style="color:#c0c5ce;">expected.
                &lt;/p&gt;
                &lt;p&gt;</span><span style="color:#bf616a;">This application uses </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">a href</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">https://esbuild.github.io/</span><span style="color:#c0c5ce;">&quot;&gt;</span><span style="color:#bf616a;">esbuild</span><span style="color:#c0c5ce;">&lt;/</span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">&gt; </span><span style="color:#bf616a;">to convert JSX</span><span style="color:#c0c5ce;">.&lt;/</span><span style="color:#96b5b4;">p&gt;
            &lt;</span><span style="color:#c0c5ce;">/&gt;
        );
    }
};
</span></code></pre>
<p>For reference, you can see my full esbuild config and my bundle scripts <a href="https://github.com/kevinfiol/mithril-pres/tree/master/scripts">here</a>. Direct any questions to <a href="mailto:me@kevinfiol.com">me@kevinfiol.com</a> and I'd be happy to answer them.</p>

    </article>

    <footer class="mt2">
        <small>
            <a href="#">return to top</a>
        </small>
    </footer>

            </div>
        </main>
        
        
        <script src="&#x2F;js&#x2F;dark-mode-switch.min.js"></script>
    </body>
</html>
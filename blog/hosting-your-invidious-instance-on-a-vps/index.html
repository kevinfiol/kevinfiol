<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <meta name="description" content="kevin f.'s personal site" />
        <link rel="shortcut icon" href="&#x2F;img&#x2F;favicon.png" type="image/x-icon" />
        <link rel="stylesheet" href="&#x2F;css&#x2F;main.css" />
        
        

        
          <link rel="alternate" type="application/atom+xml" title="RSS" href='&#x2F;atom.xml'>
        
        <title>
            
                Hosting Your Invidious Instance on a VPS
            
        </title>
    </head>

    <body>
        <div class="dark-mode-container">
            <input id="darkSwitch" type="checkbox" />
            <label class="dark-mode-btn" for="darkSwitch">ðŸŒ’</label>
        </div>
        <main class="main-content max-width-3 mx-auto">
            <div>
                
    <div class="controls p1">
        <a href="https://github.com/kevinfiol/kevinfiol.com/edit/master/content/blog/hosting-your-invidious-instance-on-a-vps.md">edit</a>
    </div>

    <header>
        <nav>
            <p class="h3">
                <a href="/">kevin f.</a>
            </p>
        </nav>
    </header>

    <small class="h5 p0 m0 light-subdue">
        August 02, 2020
    </small>

    <aside>
        
            
                <div class="toc h5 py1">
                    <div class="toc-header pb1">
                        <div class="h3">Hosting Your Invidious Instance on a VPS</div>
                        <span class="light-subdue">table of contents</span>
                    </div>
                    <ul>
                        
                            <li>
                                <a href="#1-pick-a-server" title="1. Pick a server">1. Pick a server</a>
                                
                            </li>
                        
                            <li>
                                <a href="#2-get-a-domain-or-not" title="2. Get a domain (or not)">2. Get a domain (or not)</a>
                                
                            </li>
                        
                            <li>
                                <a href="#3-pick-a-linux-distribution-for-your-vps" title="3. Pick a Linux Distribution for your VPS">3. Pick a Linux Distribution for your VPS</a>
                                
                            </li>
                        
                            <li>
                                <a href="#4-pick-how-you-re-going-to-install-invidious" title="4. Pick how you&#x27;re going to install Invidious">4. Pick how you&#x27;re going to install Invidious</a>
                                
                            </li>
                        
                            <li>
                                <a href="#5-install-it" title="5. Install it!">5. Install it!</a>
                                
                            </li>
                        
                            <li>
                                <a href="#6-optional-setting-up-nginx" title="6. (Optional) Setting up nginx">6. (Optional) Setting up nginx</a>
                                
                            </li>
                        
                            <li>
                                <a href="#7-optional-enabling-https" title="7. (Optional) Enabling HTTPS">7. (Optional) Enabling HTTPS</a>
                                
                            </li>
                        
                    </ul>
                </div>
            
        
    </aside>

    <article class="page-content">
        <h1 id="hosting-your-invidious-instance-on-a-vps"><a class="zola-anchor" href="#hosting-your-invidious-instance-on-a-vps" aria-label="Anchor link for: hosting-your-invidious-instance-on-a-vps">#</a>Hosting Your Invidious Instance on a VPS</h1>
<p><a href="https://github.com/iv-org/invidious">Invidious</a> is an alternative front-end to YouTube with an emphasis on privacy and low system resource usage. It is wonderful free software that not only does away with the annoyances of Google's bloated, ad-ridden video site, but also adds plenty of QoL features.</p>
<p>This weekend I spent some time setting up my own instance of Invidious to share with friends. Here's a quick rundown on what I did:</p>
<h2 id="1-pick-a-server"><a class="zola-anchor" href="#1-pick-a-server" aria-label="Anchor link for: 1-pick-a-server">#</a>1. Pick a server</h2>
<p>I went with the $5/mo Nanode over at <a href="https://linode.com">Linode</a>. It's packing a grand total 1GB of RAM, a single CPU, and 25GB of storage. More than enough to run our instance, but not enough to actually compile the damn codebase (we'll get to this in a bit).</p>
<h2 id="2-get-a-domain-or-not"><a class="zola-anchor" href="#2-get-a-domain-or-not" aria-label="Anchor link for: 2-get-a-domain-or-not">#</a>2. Get a domain (or not)</h2>
<p>I wanted a simple and short domain name for myself and my buddies to be able to use instead of typing an IP address in the address bar every time. Getting a domain isn't terribly important especially if you're hosting this just for your own use.</p>
<p>For the record, I used Namecheap to purchase my domain. I found <a href="https://web.archive.org/web/20200803032836/https://merelycurious.me/post/connecting-namecheap-domain-to-linode">this guide</a> particularly helpful in setting up my domain with my Linode VPS.</p>
<h2 id="3-pick-a-linux-distribution-for-your-vps"><a class="zola-anchor" href="#3-pick-a-linux-distribution-for-your-vps" aria-label="Anchor link for: 3-pick-a-linux-distribution-for-your-vps">#</a>3. Pick a Linux Distribution for your VPS</h2>
<p>Again, not terribly important what you pick. If you plan to use <a href="https://github.com/tmiland/Invidious-Updater">Invidious Updater</a>, know that it only supports Debian, Ubuntu, CentOS, Fedora, and Arch. Originally I attempted to use it on an Alpine Linux installation, but the script promptly failed.</p>
<p>Also, the Invidious docs only provide installation instructions for Arch Linux and Debian/Ubuntu. I went with <strong>Arch Linux</strong>.</p>
<h2 id="4-pick-how-you-re-going-to-install-invidious"><a class="zola-anchor" href="#4-pick-how-you-re-going-to-install-invidious" aria-label="Anchor link for: 4-pick-how-you-re-going-to-install-invidious">#</a>4. Pick how you're going to install Invidious</h2>
<p>The <a href="https://github.com/iv-org/invidious/blob/master/README.md">README</a> provides 3 options:</p>
<ul>
<li>Install Invidious manually</li>
<li>Use Invidious Updater (linked above)</li>
<li>Use Docker</li>
</ul>
<p>All options are simple and easy to do. I went with <strong>1</strong>.</p>
<h2 id="5-install-it"><a class="zola-anchor" href="#5-install-it" aria-label="Anchor link for: 5-install-it">#</a>5. Install it!</h2>
<p>Install dependencies:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">sudo</span><span style="color:#c0c5ce;"> pacman</span><span style="color:#bf616a;"> -Syu</span><span style="color:#c0c5ce;"> base-devel shards crystal librsvg postgresql nano
</span></code></pre>
<p>Create Invidious user:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">useradd -m</span><span style="color:#c0c5ce;"> invidious
</span><span style="color:#bf616a;">sudo -i -u</span><span style="color:#c0c5ce;"> invidious
</span><span style="color:#bf616a;">git</span><span style="color:#c0c5ce;"> clone https://github.com/iv-org/invidious
</span><span style="color:#96b5b4;">exit
</span></code></pre>
<p>Setup Postgres:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">sudo</span><span style="color:#c0c5ce;"> systemctl enable postgresql
</span><span style="color:#bf616a;">sudo</span><span style="color:#c0c5ce;"> systemctl start postgresql
</span><span style="color:#bf616a;">sudo -i -u</span><span style="color:#c0c5ce;"> postgres
</span><span style="color:#bf616a;">psql -c </span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">CREATE USER kemal WITH PASSWORD &#39;kemal&#39;;</span><span style="color:#c0c5ce;">&quot; </span><span style="color:#65737e;"># Change &#39;kemal&#39; here to a stronger password, and update `password` in config/config.yml
</span><span style="color:#c0c5ce;">createdb</span><span style="color:#bf616a;"> -O</span><span style="color:#c0c5ce;"> kemal invidious
</span><span style="color:#bf616a;">psql</span><span style="color:#c0c5ce;"> invidious kemal &lt; /home
</span><span style="color:#96b5b4;">exit
</span></code></pre>
<p>I was only able to run the following commands as root. Make sure the postgresql service is running:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">psql</span><span style="color:#c0c5ce;"> invidious kemal &lt; /home/invidious/invidious/config/sql/channels.sql
</span><span style="color:#bf616a;">psql</span><span style="color:#c0c5ce;"> invidious kemal &lt; /home/invidious/invidious/config/sql/videos.sql
</span><span style="color:#bf616a;">psql</span><span style="color:#c0c5ce;"> invidious kemal &lt; /home/invidious/invidious/config/sql/channel_videos.sql
</span><span style="color:#bf616a;">psql</span><span style="color:#c0c5ce;"> invidious kemal &lt; /home/invidious/invidious/config/sql/users.sql
</span><span style="color:#bf616a;">psql</span><span style="color:#c0c5ce;"> invidious kemal &lt; /home/invidious/invidious/config/sql/session_ids.sql
</span><span style="color:#bf616a;">psql</span><span style="color:#c0c5ce;"> invidious kemal &lt; /home/invidious/invidious/config/sql/nonces.sql
</span><span style="color:#bf616a;">psql</span><span style="color:#c0c5ce;"> invidious kemal &lt; /home/invidious/invidious/config/sql/annotations.sql
</span><span style="color:#bf616a;">psql</span><span style="color:#c0c5ce;"> invidious kemal &lt; /home/invidious/invidious/config/sql/playlists.sql
</span><span style="color:#bf616a;">psql</span><span style="color:#c0c5ce;"> invidious kemal &lt; /home/invidious/invidious/config/sql/playlist_videos.sql
</span></code></pre>
<p>The next steps to install Invidious involve compiling the project code. On my measly 1GB of RAM, the compilation choked. In order to prepare for this, I used <code>systemd-swap</code> to create a swapfile. There are other ways to create a swapfile or a swap partition on Linux. See: <a href="https://wiki.archlinux.org/index.php/Swap">Swap on Arch Linux Wiki</a>. I found using <code>systemd-swap</code> the simplest. <a href="https://web.archive.org/web/20200803033711/https://ricostacruz.com/til/after-installing-arch-linux">This guide by Ricosta Cruz</a> was very helpful.</p>
<p>I did as follows:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">sudo</span><span style="color:#c0c5ce;"> pacman</span><span style="color:#bf616a;"> -Syu</span><span style="color:#c0c5ce;"> systemd-swap
</span></code></pre>
<p>Then I edited the config file to enable <code>zram_enabled=1</code> and <code>swapfc_enabled=1</code>:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">sudo</span><span style="color:#c0c5ce;"> nano /etc/systemd/swap.conf
</span></code></pre>
<p>Then enable <code>systemd-swap.service</code>:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">sudo</span><span style="color:#c0c5ce;"> systemctl enable</span><span style="color:#bf616a;"> --now</span><span style="color:#c0c5ce;"> systemd-swap
</span></code></pre>
<p>Finally add the swapfile to <code>/etc/fstab</code> so it'll be used on every boot. Add this: <code>/swapfile none swap defaults 0 0</code> to the end of the file:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">sudo</span><span style="color:#c0c5ce;"> nano /etc/fstab
</span></code></pre>
<p>Finally, you won't run out of RAM to setup Invidious. Let's go back and finally install it:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">sudo -i -u</span><span style="color:#c0c5ce;"> invidious
</span><span style="color:#96b5b4;">cd</span><span style="color:#c0c5ce;"> invidious
</span><span style="color:#bf616a;">shards</span><span style="color:#c0c5ce;"> update &amp;&amp; </span><span style="color:#bf616a;">shards</span><span style="color:#c0c5ce;"> install
</span><span style="color:#bf616a;">crystal</span><span style="color:#c0c5ce;"> build src/invidious.cr</span><span style="color:#bf616a;"> --release
./invidious </span><span style="color:#65737e;"># test compiled binary, stop with ctrl c
</span><span style="color:#bf616a;">exit
</span></code></pre>
<p>It's installed! Now some administrative stuff. Let's setup the systemd service so that Invidious runs in the background:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">sudo</span><span style="color:#c0c5ce;"> cp /home/invidious/invidious/invidious.service /etc/systemd/system/invidious.service
</span><span style="color:#bf616a;">sudo</span><span style="color:#c0c5ce;"> systemctl enable invidious.service
</span><span style="color:#bf616a;">sudo</span><span style="color:#c0c5ce;"> systemctl start invidious.service
</span></code></pre>
<p>And lets rotate the logs so that they don't balloon in size:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">sudo</span><span style="color:#c0c5ce;"> echo &quot;</span><span style="color:#a3be8c;">/home/invidious/invidious/invidious.log {
rotate 4
weekly
notifempty
missingok
compress
minsize 1048576
}</span><span style="color:#c0c5ce;">&quot; | </span><span style="color:#bf616a;">tee</span><span style="color:#c0c5ce;"> /etc/logrotate.d/invidious.logrotate

</span><span style="color:#bf616a;">sudo</span><span style="color:#c0c5ce;"> chmod 0644 /etc/logrotate.d/invidious.logrotate
</span></code></pre>
<p>You now got a running Invidious instance! Navigate to your VPS's IP address on port 3000 to see it up and running. Type <code>http://&lt;VPS_IP_ADDRESS&gt;:3000</code> into your browser's address bar, and get to watching some videos!</p>
<h2 id="6-optional-setting-up-nginx"><a class="zola-anchor" href="#6-optional-setting-up-nginx" aria-label="Anchor link for: 6-optional-setting-up-nginx">#</a>6. (Optional) Setting up nginx</h2>
<p>When I bought my domain, I intended to use it for more than just Invidious. In my case, I wanted a subdomain to serve as my Invidious URL, while I can use the main domain to host a &quot;hub&quot; of sorts to other services.</p>
<p>So for example:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">http://tube.mydomain.com</span><span style="color:#c0c5ce;"> -&gt; Invidious Service
</span><span style="color:#bf616a;">http://mydomain.com</span><span style="color:#c0c5ce;"> -&gt; Homepage
</span></code></pre>
<p>I was able to do this easily using nginx reverse proxies. Here are the steps I took.</p>
<p>Install nginx:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">pacman -Syu</span><span style="color:#c0c5ce;"> nginx-mainline
</span></code></pre>
<p>Enable and start nginx service:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">sudo</span><span style="color:#c0c5ce;"> systemctl enable nginx.service
</span><span style="color:#bf616a;">sudo</span><span style="color:#c0c5ce;"> systemctl start nginx.service
</span></code></pre>
<p>Configure <code>/etc/nginx/nginx.conf</code>. Add this additional <code>server</code> entry somewhere under <code>http</code>:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">http </span><span style="color:#c0c5ce;">{
  ...

  server {
    server_name tube.mydomain.com;
    location / {
      proxy_pass http://127.0.0.1:3000;
    }
  }
  
  ...
}
</span></code></pre>
<p>Next addition is completely optional if you want your root domain to point to a kind of homepage. This is what I wanted, so I'm putting it here partly to document it for myself. I changed the existing, default <code>http.server</code> entry to point to custom <code>html</code> I had written:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#bf616a;">http </span><span style="color:#c0c5ce;">{
  server {
    server_name mydomain.com

    location / {
      root /sites/mydomain.com
      index index.html index.htm
    }

    ... </span><span style="color:#65737e;"># the rest remained unchanged from the default
  </span><span style="color:#c0c5ce;">}
  
  ...
}
</span></code></pre><h2 id="7-optional-enabling-https"><a class="zola-anchor" href="#7-optional-enabling-https" aria-label="Anchor link for: 7-optional-enabling-https">#</a>7. (Optional) Enabling HTTPS</h2>
<p>I used <a href="https://certbot.eff.org/">EFF's Certbot for this</a>. It is painfully easy to use. Note that if you choose to, it <em>will</em> make modifications to your <code>nginx.conf</code> for you.</p>
<p>You must enable an option in Invidious's config if you want assets to only be transferred via HTTPS. More information can be found <a href="https://github.com/iv-org/invidious/wiki/Configuration">here</a>.</p>
<hr />
<p>That's all. Hopefully you found this helpful. If you got any questions, shoot me an <a href="mailto:me@kevinfiol.com">email</a>. And always, if you liked this post, hit Like and Subscribe! (haha).</p>

    </article>

    <footer class="mt2">
        <small>
            <a href="#">return to top</a>
        </small>
    </footer>

            </div>
        </main>
        
        
        <script src="&#x2F;js&#x2F;dark-mode-switch.min.js"></script>
    </body>
</html>